<h1>書籍検索</h1>

<%= form_with url: search_books_path, method: :get, local: true do |f| %>
  <div class="mb-3">
    <%= f.label :query, "タイトル・著者名で検索", class: "form-label" %>
    <%= f.text_field :query, value: @query, class: "form-control", placeholder: "例：吾輩は猫である" %>
  </div>
  <%= f.submit "検索", class: "btn btn-primary" %>
<% end %>

<% if @query.present? %>
  <hr class="my-4">

  <% if @books.any? %>
    <h2>検索結果（<%= @books.size %>件）</h2>

    <div class="row">
      <% @books.each do |book| %>
        <div class="col-md-6 mb-4">
          <div class="card">
            <div class="card-body">
              <div class="row">
                <% if book[:image_url].present? %>
                  <div class="col-md-3">
                    <%= image_tag book[:image_url], alt: book[:title], class: "img-fluid" %>
                  </div>
                <% end %>

                <div class="<%= book[:image_url].present? ? 'col-md-9' : 'col-md-12' %>">
                  <h5 class="card-title"><%= book[:title] %></h5>

                  <% if book[:author].present? %>
                    <p class="card-text"><strong>著者：</strong><%= book[:author] %></p>
                  <% end %>

                  <% if book[:publisher].present? %>
                    <p class="card-text"><small class="text-muted">出版社：<%= book[:publisher] %></small></p>
                  <% end %>

                  <% if book[:published_date].present? %>
                    <p class="card-text"><small class="text-muted">出版日：<%= book[:published_date] %></small></p>
                  <% end %>

                  <% if book[:description].present? %>
                    <p class="card-text"><%= truncate(book[:description], length: 150) %></p>
                  <% end %>

                  <%= form_with url: create_from_google_books_books_path, method: :post, local: true, scope: :book do |f| %>
                    <%= f.hidden_field :title, value: book[:title] %>
                    <%= f.hidden_field :author, value: book[:author] %>
                    <%= f.hidden_field :publisher, value: book[:publisher] %>
                    <%= f.hidden_field :published_date, value: book[:published_date] %>
                    <%= f.hidden_field :description, value: book[:description] %>
                    <%= f.hidden_field :isbn, value: book[:isbn] %>
                    <%= f.hidden_field :image_url, value: book[:image_url] %>
                    <%= f.submit "この本を選択", class: "btn btn-success btn-sm" %>
                  <% end %>
                </div>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="alert alert-info">
      検索結果が見つかりませんでした。
    </div>
  <% end %>
<% end %>

<div class="mt-3">
  <%= link_to "読書記録一覧に戻る", readings_path, class: "btn btn-secondary" %>
</div>