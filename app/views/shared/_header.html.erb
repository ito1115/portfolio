<% if user_signed_in? %>
  <div class="header">
    <h1><%= link_to "TSUNDOKU", root_path, class: "logo-link" %></h1>
    <div class="header-right">
      <div class="user-info">
        <p>Welcome, <%= current_user.email %>!</p>
      </div>
      <div class="header-nav">
        <%= link_to "おすすめの一冊を見る", recommend_readings_path, class: "nav-link" %>
        <%= link_to "本を検索", search_books_path, class: "nav-link" %>
        <div class="profile-dropdown">
          <button class="nav-link profile-button" id="profileDropdownButton">
            プロフィール ▼
          </button>
          <div class="dropdown-menu" id="profileDropdownMenu">
            <%= link_to "プロフィール", profile_path, class: "dropdown-item" %>
            <%= button_to "ログアウト", destroy_user_session_path, method: :delete, class: "dropdown-item logout-button", data: { turbo: false } %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script nonce="<%= content_security_policy_nonce %>">
  // プロフィールドロップダウン機能
  document.addEventListener('turbo:load', function() {
    const dropdownButton = document.getElementById('profileDropdownButton');
    const dropdownMenu = document.getElementById('profileDropdownMenu');

    if (dropdownButton && dropdownMenu) {
      // ボタンクリックでメニューを開閉
      dropdownButton.addEventListener('click', function(e) {
        e.stopPropagation();
        dropdownMenu.classList.toggle('show');
      });

      // ドキュメント全体のクリックでメニューを閉じる
      document.addEventListener('click', function(e) {
        if (!dropdownButton.contains(e.target) && !dropdownMenu.contains(e.target)) {
          dropdownMenu.classList.remove('show');
        }
      });

      // ESCキーでメニューを閉じる
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          dropdownMenu.classList.remove('show');
        }
      });
    }
  });
  </script>

  <style>
  /* ロゴリンクのスタイル */
  .logo-link {
    text-decoration: none;
    color: inherit;
  }

  .logo-link:hover {
    opacity: 0.8;
    transition: opacity 0.2s;
  }

  /* プロフィールドロップダウンのスタイル */
  .profile-dropdown {
    position: relative;
    display: inline-block;
  }

  .profile-button {
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
    font-family: inherit;
  }

  .dropdown-menu {
    display: none;
    position: absolute;
    top: 100%;
    right: 0;
    background-color: white;
    min-width: 180px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    border-radius: 4px;
    margin-top: 8px;
    z-index: 1000;
    overflow: hidden;
  }

  .dropdown-menu.show {
    display: block;
  }

  .dropdown-item {
    display: block;
    width: 100%;
    padding: 12px 16px;
    text-decoration: none;
    color: #333;
    background: none;
    border: none;
    text-align: left;
    cursor: pointer;
    transition: background-color 0.2s;
    font-size: 14px;
    font-family: inherit;
  }

  .dropdown-item:hover {
    background-color: #f5f5f5;
  }

  .logout-button {
    border-top: 1px solid #e0e0e0;
    color: #e74c3c;
  }

  .logout-button:hover {
    background-color: #ffebee;
  }
  </style>
<% end %>
